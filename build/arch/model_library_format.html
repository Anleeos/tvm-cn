
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Model Library Format &#8212; tvm-cn 1.0.0 文档</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="microTVM: TVM on bare-metal" href="../topic/microtvm/index.html" />
    <link rel="prev" title="microTVM Project API" href="microtvm_project_api.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="model-library-format">
<span id="id1"></span><h1>Model Library Format<a class="headerlink" href="#model-library-format" title="永久链接至标题">¶</a></h1>
<div class="section" id="about-model-library-format">
<h2>About Model Library Format<a class="headerlink" href="#about-model-library-format" title="永久链接至标题">¶</a></h2>
<p>TVM traditionally exports generated libraries as Dynamic Shared Objects (e.g. DLLs (Windows) or .so
(linux)). Inferences can be performed using those libraries by loading them into an executable using
<code class="docutils literal notranslate"><span class="pre">libtvm_runtime.so</span></code>. This process is very dependent on services provided by traditional OS.</p>
<p>For deployment to unconventional platforms (e.g. those lacking traditional OS), TVM provides another
output format, Model Library Format. Initially, the microTVM project is the primary use case for this
format. Should it become useful in other use cases (and in particular, should it become possible to
export BYOC artifacts in Model Library Format), it could be used as a general-purpose TVM export
format.  Model Library Format is a tarball containing a file for each piece of the TVM compiler
output.</p>
</div>
<div class="section" id="what-can-be-exported">
<h2>What can be Exported?<a class="headerlink" href="#what-can-be-exported" title="永久链接至标题">¶</a></h2>
<p>At the time of writing, export is limited to full models built with <code class="docutils literal notranslate"><span class="pre">tvm.relay.build</span></code>.</p>
</div>
<div class="section" id="directory-layout">
<h2>Directory Layout<a class="headerlink" href="#directory-layout" title="永久链接至标题">¶</a></h2>
<p>Model Library Format is contained within a tarball. All paths are relative to the root of the
tarball:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/</span></code> - Root of the tarball</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">codegen</span></code> - Root directory for all generated device code</p>
<ul>
<li><p>(see <a class="reference internal" href="#codegen">codegen</a> section)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">executor-config/</span></code> - Configuration for the executor which drives model inference</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">graph/</span></code> - Root directory containing configuration for the GraphExecutor</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">graph.json</span></code> - GraphExecutor JSON configuration</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata.json</span></code> - Machine-parseable metadata for this model</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameters/</span></code> - Root directory where simplified parameters are placed</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;model_name&gt;.params</span></code> - Parameters for the model tvm.relay._save_params format</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/</span></code> - Root directory for all source code consumed by TVM</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">relay.txt</span></code> - Relay source code for the generated model</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="description-of-sub-directories">
<h2>Description of Sub-directories<a class="headerlink" href="#description-of-sub-directories" title="永久链接至标题">¶</a></h2>
<div class="section" id="codegen">
<span id="subdir-codegen"></span><h3><code class="docutils literal notranslate"><span class="pre">codegen</span></code><a class="headerlink" href="#codegen" title="永久链接至标题">¶</a></h3>
<p>All TVM-generated code is placed in this directory. At the time of writing, there is 1 file per
Module in the generated Module tree, though this restriction may change in the future. Files in
this directory should have filenames of the form <code class="docutils literal notranslate"><span class="pre">&lt;target&gt;/(lib|src)/&lt;unique_name&gt;.&lt;format&gt;</span></code>.</p>
<p>These components are described below:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;target&gt;</span></code> - Identifies the TVM target on which the code should run. Currently, only <code class="docutils literal notranslate"><span class="pre">host</span></code>
is supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;unique_name&gt;</span></code> - A unique slug identifying this file. Currently <code class="docutils literal notranslate"><span class="pre">lib&lt;n&gt;</span></code>, with <code class="docutils literal notranslate"><span class="pre">&lt;n&gt;&gt;</span></code> an
auto-incrementing integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;format&gt;</span></code> - Suffix identifying the filename format. Currently <code class="docutils literal notranslate"><span class="pre">c</span></code> or <code class="docutils literal notranslate"><span class="pre">o</span></code>.</p></li>
</ul>
</div></blockquote>
<p>An example directory tree for a CPU-only model is shown below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">codegen/</span></code> - Codegen directory</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">host/</span></code> - Generated code for <code class="docutils literal notranslate"><span class="pre">target_host</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lib/</span></code> - Generated binary object files</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lib0.o</span></code> - LLVM module (if <code class="docutils literal notranslate"><span class="pre">llvm</span></code> target is used)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lib1.o</span></code> - LLVM CRT Metadata Module (if <code class="docutils literal notranslate"><span class="pre">llvm</span></code> target is used)</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src/</span></code> - Generated C source</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">lib0.c</span></code> - C module (if <code class="docutils literal notranslate"><span class="pre">c</span></code> target is used)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lib1.c</span></code> - C CRT Metadata module (if <code class="docutils literal notranslate"><span class="pre">c</span></code> target is used)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="executor-config">
<h3><code class="docutils literal notranslate"><span class="pre">executor-config</span></code><a class="headerlink" href="#executor-config" title="永久链接至标题">¶</a></h3>
<p>Contains machine-parsable configuration for executors which can drive model inference. Currently,
only the GraphExecutor produces configuration for this directory, in <code class="docutils literal notranslate"><span class="pre">graph/graph.json</span></code>. This
file should be read in and the resulting string supplied to the <code class="docutils literal notranslate"><span class="pre">GraphExecutor()</span></code> constructor for
parsing.</p>
</div>
<div class="section" id="parameters">
<h3><code class="docutils literal notranslate"><span class="pre">parameters</span></code><a class="headerlink" href="#parameters" title="永久链接至标题">¶</a></h3>
<p>Contains machine-parseable parameters. A variety of formats may be provided, but at present, only
the format produced by <code class="docutils literal notranslate"><span class="pre">tvm.relay._save_params</span></code> is supplied. When building with
<code class="docutils literal notranslate"><span class="pre">tvm.relay.build</span></code>,  the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter is considered to be the model name. A single file is
created in this directory <code class="docutils literal notranslate"><span class="pre">&lt;model_name&gt;.json</span></code>.</p>
</div>
<div class="section" id="src">
<h3><code class="docutils literal notranslate"><span class="pre">src</span></code><a class="headerlink" href="#src" title="永久链接至标题">¶</a></h3>
<p>Contains source code parsed by TVM. Currently, just the Relay source code is created in
<code class="docutils literal notranslate"><span class="pre">src/relay.txt</span></code>.</p>
</div>
</div>
<div class="section" id="metadata">
<h2>Metadata<a class="headerlink" href="#metadata" title="永久链接至标题">¶</a></h2>
<p>Machine-parseable metadata is placed in a file <code class="docutils literal notranslate"><span class="pre">metadata.json</span></code> at the root of the tarball.
Metadata is a dictionary with these keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">export_datetime</span></code>: Timestamp when this Model Library Format was generated, in
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior">strftime</a>
format <code class="docutils literal notranslate"><span class="pre">&quot;%Y-%M-%d</span> <span class="pre">%H:%M:%SZ&quot;,</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory</span></code>: A summary of the memory usage of each generated function. Documented in
<a class="reference internal" href="#memory-usage-summary">Memory Usage Summary</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model_name</span></code>: The name of this model (e.g. the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter supplied to
<code class="docutils literal notranslate"><span class="pre">tvm.relay.build</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">executors</span></code>: A list of executors supported by this model. Currently, this list is always
<code class="docutils literal notranslate"><span class="pre">[&quot;graph&quot;]</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target</span></code>: A dictionary mapping <code class="docutils literal notranslate"><span class="pre">device_type</span></code> (the underlying integer, as a string) to the
sub-target which describes that relay backend used for that <code class="docutils literal notranslate"><span class="pre">device_type</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: A numeric version number that identifies the format used in this Model Library
Format. This number is incremented when the metadata structure or on-disk structure changes.
This document reflects version <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></li>
</ul>
<div class="section" id="memory-usage-summary">
<h3>Memory Usage Summary<a class="headerlink" href="#memory-usage-summary" title="永久链接至标题">¶</a></h3>
<p>A dictionary with these sub-keys:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;main&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">list[MainFunctionWorkspaceUsage]</span></code>. A list summarizing memory usage for each
workspace used by the main function and all sub-functions invoked.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;operator_functions&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">map[string,</span> <span class="pre">list[FunctionWorkspaceUsage]]</span></code>. Maps operator function
name to a list summarizing memory usage for each workpace used by the function.</p></li>
</ul>
</div></blockquote>
<p>A <code class="docutils literal notranslate"><span class="pre">MainFunctionWorkspaceUsage</span></code> is a dict with these keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;device&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. The <code class="docutils literal notranslate"><span class="pre">device_type</span></code> associated with this workspace.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;workspace_size_bytes&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. Number of bytes needed in this workspace by this function
and all sub-functions invoked.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;constants_size_bytes&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. Size of the constants used by the main function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;io_size_bytes&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. Sum of the sizes of the buffers used from this workspace by this
function and sub-functions.</p></li>
</ul>
<p>A <code class="docutils literal notranslate"><span class="pre">FunctionWorkspaceUsage</span></code> is a dict with these keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;device&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. The <code class="docutils literal notranslate"><span class="pre">device_type</span></code> associated with this workspace.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;workspace_size_bytes&quot;</span></code>: <code class="docutils literal notranslate"><span class="pre">int</span></code>. Number of bytes needed in this workspace by this function.</p></li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">tvm-cn</a></h1>








<h3>导航</h3>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">安装 TVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributor Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to/index.html">How To Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/how_to/how_to.html">Developer How-To Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Design and Architecture</a></li>
</ul>
<p class="caption"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Design and Architecture</a><ul>
      <li>Previous: <a href="microtvm_project_api.html" title="上一章">microTVM Project API</a></li>
      <li>Next: <a href="../topic/microtvm/index.html" title="下一章">microTVM: TVM on bare-metal</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, HyperAI.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/arch/model_library_format.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>