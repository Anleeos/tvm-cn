
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error Handling Guide &#8212; tvm-cn 1.0.0 文档</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="How To Guides" href="../how_to/index.html" />
    <link rel="prev" title="Release Process" href="release_process.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="error-handling-guide">
<span id="id1"></span><h1>Error Handling Guide<a class="headerlink" href="#error-handling-guide" title="永久链接至标题">¶</a></h1>
<div class="contents local topic" id="id2">
<ul class="simple">
<li><p><a class="reference internal" href="#raise-a-specific-error-in-c" id="id3">Raise a Specific Error in C++</a></p></li>
<li><p><a class="reference internal" href="#how-to-choose-an-error-type" id="id4">How to choose an Error Type</a></p></li>
</ul>
</div>
<p>TVM contains structured error classes to indicate specific types of error.
Please raise a specific error type when possible, so that users can
write code to handle a specific error category if necessary.
You can directly raise the specific error object in python.
In other languages like c++, you simply add <code class="docutils literal notranslate"><span class="pre">&lt;ErrorType&gt;:</span></code> prefix to
the error message(see below).</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Please refer to <code class="xref py py-mod docutils literal notranslate"><span class="pre">tvm.error</span></code> for the list of errors.</p>
</div>
<div class="section" id="raise-a-specific-error-in-c">
<h2><a class="toc-backref" href="#id3">Raise a Specific Error in C++</a><a class="headerlink" href="#raise-a-specific-error-in-c" title="永久链接至标题">¶</a></h2>
<p>You can add <code class="docutils literal notranslate"><span class="pre">&lt;ErrorType&gt;:</span></code> prefix to your error message to
raise an error of the corresponding type.
Note that you do not have to add a new type
<code class="xref py py-class docutils literal notranslate"><span class="pre">tvm.error.TVMError</span></code> will be raised by default when
there is no error type prefix in the message.
This mechanism works for both <code class="docutils literal notranslate"><span class="pre">LOG(FATAL)</span></code> and <code class="docutils literal notranslate"><span class="pre">ICHECK</span></code> macros.
The following code gives an example on how to do so.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// src/api_test.cc</span>
<span class="kt">void</span> <span class="nf">ErrorTest</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">ICHECK_EQ</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ValueError: expect x and y to be equal.&quot;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">LOG</span><span class="p">(</span><span class="n">FATAL</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;InternalError: cannot reach here&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above function is registered as PackedFunc into the python frontend,
under the name <code class="docutils literal notranslate"><span class="pre">tvm._api_internal._ErrorTest</span></code>.
Here is what will happen if we call the registered function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tvm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tvm</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">ErrorTest</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;/path/to/tvm/python/tvm/_ffi/_ctypes/function.py&quot;</span>, line <span class="m">190</span>, in <span class="n">__call__</span>
    <span class="k">raise</span> <span class="n">get_last_ffi_error</span><span class="p">()</span>
<span class="gr">ValueError</span>: <span class="n">Traceback (most recent call last):</span>
<span class="go">  [bt] (3) /path/to/tvm/build/libtvm.so(TVMFuncCall+0x48) [0x7fab500b8ca8]</span>
<span class="go">  [bt] (2) /path/to/tvm/build/libtvm.so(+0x1c4126) [0x7fab4f7f5126]</span>
<span class="go">  [bt] (1) /path/to/tvm/build/libtvm.so(+0x1ba2f8) [0x7fab4f7eb2f8]</span>
<span class="go">  [bt] (0) /path/to/tvm/build/libtvm.so(+0x177d12) [0x7fab4f7a8d12]</span>
  File <span class="nb">&quot;/path/to/tvm/src/api/api_test.cc&quot;</span>, line <span class="m">80</span>
<span class="gr">ValueError</span>: <span class="n">Check failed: x == y (0 vs. 1) : expect x and y to be equal.</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tvm</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">ErrorTest</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;/path/to/tvm/python/tvm/_ffi/_ctypes/function.py&quot;</span>, line <span class="m">190</span>, in <span class="n">__call__</span>
    <span class="k">raise</span> <span class="n">get_last_ffi_error</span><span class="p">()</span>
<span class="gr">tvm.error.InternalError</span>: <span class="n">Traceback (most recent call last):</span>
<span class="go">  [bt] (3) /path/to/tvm/build/libtvm.so(TVMFuncCall+0x48) [0x7fab500b8ca8]</span>
<span class="go">  [bt] (2) /path/to/tvm/build/libtvm.so(+0x1c4126) [0x7fab4f7f5126]</span>
<span class="go">  [bt] (1) /path/to/tvm/build/libtvm.so(+0x1ba35c) [0x7fab4f7eb35c]</span>
<span class="go">  [bt] (0) /path/to/tvm/build/libtvm.so(+0x177d12) [0x7fab4f7a8d12]</span>
  File <span class="nb">&quot;/path/to/tvm/src/api/api_test.cc&quot;</span>, line <span class="m">83</span>
<span class="gr">InternalError</span>: <span class="n">cannot reach here</span>
<span class="go">TVM hint: You hit an internal error. Please open a thread on https://discuss.tvm.ai/ to report it.</span>
</pre></div>
</div>
<p>As you can see in the above example, TVM’s ffi system combines
both the python and c++’s stacktrace into a single message, and generate the
corresponding error class automatically.</p>
</div>
<div class="section" id="how-to-choose-an-error-type">
<h2><a class="toc-backref" href="#id4">How to choose an Error Type</a><a class="headerlink" href="#how-to-choose-an-error-type" title="永久链接至标题">¶</a></h2>
<p>You can go through the error types are listed below, try to use common
sense and also refer to the choices in the existing code.
We try to keep a reasonable amount of error types.
If you feel there is a need to add a new error type, do the following steps:</p>
<ul class="simple">
<li><p>Send a RFC proposal with a description and usage examples in the current codebase.</p></li>
<li><p>Add the new error type to <code class="xref py py-mod docutils literal notranslate"><span class="pre">tvm.error</span></code> with clear documents.</p></li>
<li><p>Update the list in this file to include the new error type.</p></li>
<li><p>Change the code to use the new error type.</p></li>
</ul>
<p>We also recommend to use less abstraction when creating the short error messages.
The code is more readable in this way, and also opens path to craft specific
error messages when necessary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">preferred</span><span class="p">():</span>
    <span class="c1"># Very clear about what is being raised and what is the error message.</span>
    <span class="k">raise</span> <span class="n">OpNotImplemented</span><span class="p">(</span><span class="s2">&quot;Operator relu is not implemented in the MXNet frontend&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_op_not_implemented</span><span class="p">(</span><span class="n">op_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">OpNotImplemented</span><span class="p">(</span><span class="s2">&quot;Operator </span><span class="si">{}</span><span class="s2"> is not implemented.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">not_preferred</span><span class="p">():</span>
    <span class="c1"># Introduces another level of indirection.</span>
    <span class="k">raise</span> <span class="n">_op_not_implemented</span><span class="p">(</span><span class="s2">&quot;relu&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we need to introduce a wrapper function that constructs multi-line error messages,
please put wrapper in the same file so other developers can look up the implementation easily.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">tvm-cn</a></h1>








<h3>导航</h3>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installing TVM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how_to/index.html">How To Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/tutorial/index.html">Developer Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/how_to/how_to.html">Developer How-To Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Architecture Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">Design and Architecture</a></li>
</ul>
<p class="caption"><span class="caption-text">Topic Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topic/microtvm/index.html">microTVM: TVM on bare-metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topic/vta/index.html">VTA: Versatile Tensor Accelerator</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Contributor Guide</a><ul>
      <li>Previous: <a href="release_process.html" title="上一章">Release Process</a></li>
      <li>Next: <a href="../how_to/index.html" title="下一章">How To Guides</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, HyperAI.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/contribute/error_handling.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>